

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>The Problem Definition Input Class &#8212; RAT dev documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/chapter2';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A Closer Look at the Controls Class" href="controlsInfo.html" />
    <link rel="prev" title="Introduction" href="chapter1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="RAT dev documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="RAT dev documentation - Home"/>`);</script>
  
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../index.html">
                        Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../support.html">
                        Support
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../index.html">
                        Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../guide.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../support.html">
                        Support
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="chapter1.html">Introduction</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">The Problem Definition Input Class</a></li>

<li class="toctree-l2"><a class="reference internal" href="controlsInfo.html">A Closer Look at the Controls Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="customModels.html">Custom Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="savingAndClasses.html">Saving Your Work (working with classes)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../algorithms.html">Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../simplex.html">Nelder-Mead Simplex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DE.html">Differential Evolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DREAM.html">Bayesian Analysis - DREAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nestedSampling.html">Bayesian Model Selection - Nested Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../paramonte.html">The Paramonte Sampler</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced.html">Advanced Topics</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../resampling.html">Profile Resampling (‘microslicing’)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallelisation.html">Parallelising Calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../customLanguages.html">Custom Models in Python or C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events.html">Handling Events During Calculations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../calcTypes.html">Different Calculation Types</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../imaginary.html">Adding the Imaginary Refractive Index</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../incoherent.html">Incoherent Summing (Domains)</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../domainsStanlay.html">Standard Layers Domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../domainsCustomLayers.html">Custom Models with Domains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../domainsCustomXY.html">Custom XY Models with Domains</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../oilWater.html">Reflectivity from Oil/Water Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../magnetic.html">Reflectivity from Magnetic Samples</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../utilities.html">Utility Functions</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../plotFuns.html">Basic Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plotFunsBayes.html">Plotting Bayesian Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../livePlot.html">Events and Live Updating Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conversionFuncs.html">Convert between RAT and RasCAL1</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../guide.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Tutorial</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">The Problem...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="the-problem-definition-input-class">
<span id="chapter2"></span><h1>The Problem Definition Input Class<a class="headerlink" href="#the-problem-definition-input-class" title="Permalink to this heading">#</a></h1>
<p>In the previous section, we saw an example of how we set up and run an analysis using the RAT toolbox. Every call to the toolbox has two parts: the <strong>problem definition</strong> class, where we define the model, add the data and define our contrasts, and the <strong>controls class</strong> where we
tell the toolbox what type of analysis we would like to do. The reason for splitting things up in this way is that once our model is defined, we can interact with it in various ways without needing to modify the model. So, we can experiment with our data, trying out different types of analysis, and explore the
landscape of solutions by simply modifying the <em>controls</em> class, leaving the <em>problem</em> class alone.</p>
<p>As well as having two inputs, RAT always provides two outputs, so the call to the toolbox is always of this form:-</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-0">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">RAT</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="n">controls</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-1">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In this case we have called our inputs <em>problem</em> and <em>controls</em>, but they can be called anything. Likewise, we have called our outputs <em>problem</em> and <em>results</em>, but we are free to call them anything we like. We will look at the outputs in more detail in the next section.</p>
<p>The first input, <em>problem</em>, is an instance of a class called <em>projectClass</em>:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-2">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">projectClass</span><span class="p">(</span><span class="s">&#39;my project&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="nb">class</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

<span class="nb">ans</span><span class="w"> </span><span class="p">=</span>
<span class="w">    </span><span class="s">&#39;projectClass&#39;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-3">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="s1">&#39;my project&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">RAT</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">Project</span><span class="s1">&#39;&gt;</span>
</pre></div>
</div>
</div>
</div>
<p>And if we take a look at it, we can see the class contains a series of sections, where we can define our parameters, make different kinds of model, load in our data and do everything we need to set up our model.</p>
<img alt="model (first half)" src="../_images/model1.png" />
<img alt="model (second half)" src="../_images/model2.png" />
<p>We can see that the class has a number of attributes, defining all we need for our analysis. In our case, we have no parameters or data, and have not defined any contrasts, so this will not do anything useful in RAT. Defining a model is a case of populating the sections in the project class, which we do using the class methods:</p>
<img alt="Project Class Methods" src="../_images/projectClassMethods.png" />
<p>It’s clear from the method names (i.e. <em>addData</em>) that these methods are going to be useful to us for building our model. In the following sections,
we will look at each of these methods and see how they can be used to define our reflectivity analysis problem. (There is also a utility which will convert a RasCAL model into a <em>projectClass</em> for use in RAT.
This means that you can use the RasCAL GUI to set up your model if you like and then use the speed of RAT to conduct your analysis.)</p>
<p>In terms of the outputs, note that we have called the first output <em>problem</em>, but we don’t need to do that. The first of the two outputs is another <strong>projectClass</strong>, but updated with the results of the calculation.
So, if we run a fit, the fitted parameters will be updated with the best fit values of our procedure. In giving the output the same name as the input, we’re overwriting our input with best fit values, but if you don’t
want to do this, you can give the inputs and outputs different names (e.g. ‘[outProblem,results] = RAT(problem,controls)’’ or whatever you like). The second output can also be called whatever you like, and this is a struct
containing the simulated reflectivities, SLD’s and so on from whatever procedure you have asked RAT to do:</p>
<a class="reference internal image-reference" href="../_images/reflectivitiesStruct.png"><img alt="Reflectivities Struct" src="../_images/reflectivitiesStruct.png" style="width: 300px;" /></a>
<p>In the next sections, we’ll discuss the methods of the <strong>projectClass</strong>, and see how they allow us to build up a model by populating the various sections.</p>
<section id="the-components-of-projectclass">
<h2>The Components of ProjectClass<a class="headerlink" href="#the-components-of-projectclass" title="Permalink to this heading">#</a></h2>
<section id="project-defining-methods">
<h3><strong>Project Defining Methods</strong><a class="headerlink" href="#project-defining-methods" title="Permalink to this heading">#</a></h3>
<p>The first step is always to create an instance of the <strong>projectClass</strong> to hold our model. This is always done by assigning <strong>projectClass</strong> to our variable name (we will mostly use <em>problem</em> in this manual, but it can be anything), which always requires a name for our project as an input:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-4">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">projectClass</span><span class="p">(</span><span class="s">&#39;My Problem&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>This creates an instance of <strong>projectClass</strong> and assigns it to the variable <em>problem</em>, and gives it the title ‘My Problem’.</p>
<p>The first part of the created <em>problem</em> has two other settable fields: <em>modelType</em> and <em>Geometry</em>.</p>
<p><strong>Geometry -</strong> This can be set to either <em>air/substrate</em> or <em>substrate/liquid</em> using the <strong>setGeometry</strong> method. It can take the values of <em>air/substrate</em> or <em>substrate/liquid</em>.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-5" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-5">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="s">&#39;air/substrate&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="s">&#39;substrate/liquid&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-6">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="s1">&#39;air/substrate&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="s1">&#39;substrate/liquid&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>The effect of this parameter is in the numbering of roughness’s in layer models. In any model for n-layers,
there are always n+1 associated interfaces, and hence n+1 roughness parameters required. In RAT, the bulk interface roughness
is a protected parameter and always exists, and this parameter controls where this roughness is placed in the layer stack. So, for two layers defined with thickness,
SLD and roughness as [d<sub>1</sub>, <span class="math notranslate nohighlight">\(\rho_\mathrm{1}\)</span>, r<sub>1</sub>] and [d<sub>2</sub>, <span class="math notranslate nohighlight">\(\rho_\mathrm{2}\)</span>, r<sub>2</sub>], then for the <em>substrate/liquid</em> geometry
the substrate roughness is placed as the first roughness the beam meets, and the layer roughness’s refer to the interface after the particular layer.
or the <em>air/substrate</em> case, the opposite is true, and the substrate roughness is the last roughness in the stack, with the layer roughness referring to the interface before each layer.</p>
<p>ModelType - As is the case for RasCAL, there are three ways of defining models in RAT:-</p>
<ul class="simple">
<li><p><strong>Standard Layers</strong> - The model is defined in terms of parameters, which are distributed into layers, and subsequently grouped into contrasts. No external functions are needed.</p></li>
<li><p><strong>Custom Layers</strong> - Parameters are again defined and grouped into layers, but this time the layer definitions come from a user model script. This then gives complete flexibility of how layers are defined, so allowing models to be written in terms of area per molecule or material density, for example. This custom script controls translating these input parameters into a [d, <span class="math notranslate nohighlight">\(\rho\)</span>, r] model. This is probably the most useful operating mode for RasCAL.</p></li>
<li><p><strong>Custom XY-Profile</strong> - This modelling mode also relies on a custom model function, but in this case does away with [d, <span class="math notranslate nohighlight">\(\rho\)</span>, r] layers completely. Instead, the custom function uses the parameters to define a continuous SLD profile, which RAT then uses to calculate the reflectivity.</p></li>
</ul>
<p>The model type is set using the <strong>setModelType</strong> method:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-7" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-7">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">setModelType</span><span class="p">(</span><span class="s">&#39;standard layers&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">setModelType</span><span class="p">(</span><span class="s">&#39;custom layers&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">setModelType</span><span class="p">(</span><span class="s">&#39;custom XY&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-8" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-8">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;standard layers&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;custom layers&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;custom XY&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Custom modelling is described in more depth in a later section.</p>
</section>
<section id="the-parameters-block">
<h3><strong>The ‘Parameters’ Block</strong><a class="headerlink" href="#the-parameters-block" title="Permalink to this heading">#</a></h3>
<p>Any model, where it be layers or anything else is always defined by parameters. These appear in the parameters block and are specified by a name, a value, minimum and maximum ranges and a flag defining whether the parameter is fitted or fixed:</p>
<a class="reference internal image-reference" href="../_images/parameterBlock.png"><img alt="Parameter Block" src="../_images/parameterBlock.png" style="width: 500px;" /></a>
<p>The substrate roughness is a protected parameter in all cases (it defines the Fresnel roughness) and cannot be renamed or deleted. Its values can be set to any numerical values however.</p>
<p>To add a parameter, you can use the <strong>addParam</strong> method, either by just specifying a name, in which case the parameter takes on default values, or by specifying the whole parameter at once (note the Matlab cell array curly brackets syntax for the latter):</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-9" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-9">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">addParameter</span><span class="p">(</span><span class="s">&#39;My new param&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">addParameter</span><span class="p">(</span><span class="s">&#39;My other new param&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-10" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-10">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;My new param&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;My other new param&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To avoid having to make a whole load of <strong>addParam</strong> statements for large projects with many parameters, you can define them at once in a cell array, and add them using the <strong>addParamGroup</strong> method (again notice the curly brackets syntax - this is a {cell array of {cell arrays}} :</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-11" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-11">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">pGroup</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{{</span><span class="s">&#39;Layer thick&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Layer SLD&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">3e-6</span><span class="w"> </span><span class="mf">5e-6</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Layer rough&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">}};</span>

<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">addParameterGroup</span><span class="p">(</span><span class="n">pGroup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting parameters block looks like this:</p>
<a class="reference internal image-reference" href="../_images/resultingParameterBlock1.png"><img alt="Parameter Block after adding param group" src="../_images/resultingParameterBlock1.png" style="width: 400px;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Parameters can’t have duplicate names. Attempting to duplicate a name will throw an error. This can cause problems when loading in RasCAL1 projects
where duplicate names are allowed.</p>
</div>
<p>To subsequently change the values of the parameters (including names), there are a few methods you can use. For each of the methods, you can refer to the parameter by its name or its number. There are dedicated methods for each of the attributes of the parameters:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-12" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-12">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setParameterName</span><span class="p">(</span><span class="s">&#39;My new param&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;My changed param&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setParameterConstr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.96</span><span class="p">,</span><span class="mf">3.62</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setParameterValue</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mf">20.22</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setParameterFit</span><span class="p">(</span><span class="s">&#39;Layer rough&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-13">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;My changed param&#39;</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="mf">0.96</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mf">3.62</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">20.22</span>
<span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/resultingParameterBlock2.png"><img alt="Parameter Block after changing properties" src="../_images/resultingParameterBlock2.png" style="width: 600px;" /></a>
<p>Alternatively, you can set a number of properties of a given parameter at once using name / value pairs.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-14" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-14">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setParameter</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;thick&#39;</span><span class="p">,</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="s">&#39;max&#39;</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-15">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;thick&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">33</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/resultingParameterBlock3.png"><img alt="Parameter Block after changing properties using set parameter" src="../_images/resultingParameterBlock3.png" style="width: 600px;" /></a>
<p>You can remove a parameter from the block using its name or number. Note that if you remove a parameter from the middle of the block, subsequent parameter numbers will change. Also, if you try to remove the substrate roughness you will get an error:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-16" name="sd-tab-set-9" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-16">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">removeParameter</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-17" name="sd-tab-set-9" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-17">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">problem</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/resultingParameterBlock4.png"><img alt="Parameter Block after removing a parameter" src="../_images/resultingParameterBlock4.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/parameterRemoveError.png"><img alt="Error when trying to remove Substrate Roughness" src="../_images/parameterRemoveError.png" style="width: 600px;" /></a>
</section>
<section id="the-layers-block-standard-layers-models-only">
<h3><strong>The Layers Block (Standard Layers models only)</strong><a class="headerlink" href="#the-layers-block-standard-layers-models-only" title="Permalink to this heading">#</a></h3>
<p>For each of the custom models cases, the model building is done using a script (discussed in detail in chapter 3). For standard layers models however, model building is done by grouping the parameters into layers, and then into contrasts (as is the case for RasCAL). The layers block is not visible when either of the two custom modes is selected. Again, layers are built using methods of the project class. As an example here, we make a new project class, add some parameters, and create some layers.</p>
<p>For this example, we will make two layers representing a deuterated and hydrogenated version of the same layer. So, the layers will share all their parameters except for the SLD.</p>
<p>Start by making a new project, and adding the parameters we will need:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-18" name="sd-tab-set-10" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-18">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">projectClass</span><span class="p">(</span><span class="s">&#39;Layers Example&#39;</span><span class="p">);</span>

<span class="n">params</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{{</span><span class="s">&#39;Layer Thickness&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;H SLD&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">6e-6</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">4e-6</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1e-6</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;D SLD&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">5e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">7e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">9e-6</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Layer rough&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">};</span>
<span class="w">        </span><span class="p">{</span><span class="s">&#39;Layer hydr&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">}};</span>

<span class="n">problem</span><span class="p">.</span><span class="n">addParameterGroup</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-19" name="sd-tab-set-10" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-19">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="s1">&#39;Layers Example&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>A layer is defined in terms of a name, thickness, SLD, roughness and (optional) hydration, along with details of which bulk phase is hydrating the layer. The easiest way to define these is to group the parameters into cell arrays, and then add them to the project as a layers group:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-20" name="sd-tab-set-11" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-20">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Make the layers</span>
<span class="n">H_layer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;H Layer&#39;</span><span class="p">,</span><span class="s">&#39;Layer Thickness&#39;</span><span class="p">,</span><span class="s">&#39;H SLD&#39;</span><span class="p">,</span><span class="s">&#39;Layer rough&#39;</span><span class="p">,</span><span class="s">&#39;Layer hydr&#39;</span><span class="p">,</span><span class="s">&#39;bulk out&#39;</span><span class="p">};</span>
<span class="n">D_layer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;D Layer&#39;</span><span class="p">,</span><span class="s">&#39;Layer Thickness&#39;</span><span class="p">,</span><span class="s">&#39;D SLD&#39;</span><span class="p">,</span><span class="s">&#39;Layer rough&#39;</span><span class="p">,</span><span class="s">&#39;Layer hydr&#39;</span><span class="p">,</span><span class="s">&#39;bulk out&#39;</span><span class="p">};</span>

<span class="c">% Add them to the project - as a cell array{}</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addLayerGroup</span><span class="p">({</span><span class="n">H_layer</span><span class="p">,</span><span class="w"> </span><span class="n">D_layer</span><span class="p">});</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-21" name="sd-tab-set-11" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-21">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;H Layer&#39;</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="s1">&#39;Layer Thickness&#39;</span><span class="p">,</span> <span class="n">SLD</span><span class="o">=</span><span class="s1">&#39;H SLD&#39;</span><span class="p">,</span>
                      <span class="n">roughness</span><span class="o">=</span><span class="s1">&#39;Layer rough&#39;</span><span class="p">,</span> <span class="n">hydration</span><span class="o">=</span><span class="s1">&#39;Layer hydr&#39;</span><span class="p">,</span> <span class="n">hydrate_with</span><span class="o">=</span><span class="s1">&#39;bulk out&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;D Layer&#39;</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="s1">&#39;Layer Thickness&#39;</span><span class="p">,</span> <span class="n">SLD</span><span class="o">=</span><span class="s1">&#39;D SLD&#39;</span><span class="p">,</span>
                      <span class="n">roughness</span><span class="o">=</span><span class="s1">&#39;Layer rough&#39;</span><span class="p">,</span> <span class="n">hydration</span><span class="o">=</span><span class="s1">&#39;Layer hydr&#39;</span><span class="p">,</span> <span class="n">hydrate_with</span><span class="o">=</span><span class="s1">&#39;bulk out&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Our two layers now appear in the Layers block of the project:</p>
<img alt="Layers after adding two layers" src="../_images/twoLayerGroup.png" />
<p>Note that in RAT, hydration is percent hydration between 0 and 100. It is not necessary to define a hydration at all, and we can also make layers without this parameter:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-22" name="sd-tab-set-12" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-22">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Non hydrated layer</span>
<span class="n">Dry_Layer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Dry Layer&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Layer Thickness&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;D SLD&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Layer rough&#39;</span><span class="p">};</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">Dry_Layer</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<img alt="Layers after adding third dry layer" src="../_images/threeLayerGroup1.png" />
<p>To set the value of an existing layer, you can use the ‘setLayerValue’ method, at the moment using numbers for the layer number, layer parameter and parameter to be changed. So for example:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-23" name="sd-tab-set-13" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-23">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setLayerValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>changes parameter 2 (Thickness) of Layer 1 (H Layer) to the 3rd Parameter of the parameter block (H SLD):</p>
<img alt="Layers after changing thickness" src="../_images/threeLayerGroup2.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SetLayer Value allows the use of names rather than numbers if required because numbers are not very intuitive.</p>
</div>
<p>The layers are then used to set up the contrasts as usual with a standard layers model.</p>
</section>
<section id="bulk-phases">
<h3><strong>Bulk Phases</strong><a class="headerlink" href="#bulk-phases" title="Permalink to this heading">#</a></h3>
<p>These are treated in the same way as parameters e.g.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-24" name="sd-tab-set-14" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-24">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addBulkIn</span><span class="p">(</span><span class="s">&#39;Silicon&#39;</span><span class="p">,</span><span class="mf">2.0e-6</span><span class="p">,</span><span class="mf">2.07e-6</span><span class="p">,</span><span class="mf">2.1e-6</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBulkOut</span><span class="p">(</span><span class="s">&#39;H2O&#39;</span><span class="p">,</span><span class="o">-</span><span class="mf">0.6e-6</span><span class="p">,</span><span class="o">-</span><span class="mf">0.56e-6</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5e-6</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-25" name="sd-tab-set-14" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-25">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">bulk_in</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Silicon&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">2.0e-06</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.073e-06</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">2.1e-06</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;D2O&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.6e-6</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">0.56e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=-</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/bulkPhases.png"><img alt="Bulk In and Bulk Out" src="../_images/bulkPhases.png" style="width: 600px;" /></a>
<p>There are no individual methods for each parameter of these, but the values can be modified using name / value pairs as is the case for parameters, using the <strong>setBulkIn</strong> and <strong>setBulkOut</strong> methods e.g.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-26" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-26">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setBulkOut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;value&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">5.9e-6</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-27" name="sd-tab-set-15" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-27">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.9e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="scalefactors">
<h3><strong>Scalefactors</strong><a class="headerlink" href="#scalefactors" title="Permalink to this heading">#</a></h3>
<p>The <em>scalefactors</em> are another parameters block like the bulk phases. You can add <em>scalefactors</em> with the <strong>addScalefactor</strong> method. Similarly, you can set the values with the <strong>setScalefactor</strong> method as with the previous blocks.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-28" name="sd-tab-set-16" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-28">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addScalefactor</span><span class="p">(</span><span class="s">&#39;New Scalefactor&#39;</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setScalefactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">,</span><span class="mf">1.01</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-29" name="sd-tab-set-16" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-29">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">scalefactors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;New Scalefactor&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">scalefactors</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="backgrounds">
<h3><strong>Backgrounds</strong><a class="headerlink" href="#backgrounds" title="Permalink to this heading">#</a></h3>
<p>The backgrounds block is used to define the type of background applied to each contrast, and the parameters used to define the backgrounds themselves. The fittable parameters are in the
‘Background Params’ block, and the backgrounds themselves are in the ‘Backgrounds’ block:</p>
<a class="reference internal image-reference" href="../_images/basicBackground.png"><img alt="basic background" src="../_images/basicBackground.png" style="width: 800px;" /></a>
<p>The ‘Background Parameters’ is in fact another instance of the parametersClass, and there are corresponding methods to fit, set limits and so on for these.</p>
<p>The backgrounds can be one of three types: ‘constant’, ‘function’ or ‘data’. The three types are discussed in more detail below:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only ‘constant’ and ‘data’ are allowed in phase 1, and ‘function’ will be introduced in phase 2.</p>
</div>
<ul class="simple">
<li><p><strong>Constant</strong> - This is the normal background type from RasCAL1. Each background requires one <em>and only one</em> Background Parameter associated with it, as follows:</p></li>
</ul>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-30" name="sd-tab-set-17" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-30">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addBackgroundParam</span><span class="p">(</span><span class="s">&#39;My New Backpar&#39;</span><span class="p">,</span><span class="mf">1e-8</span><span class="p">,</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBackground</span><span class="p">(</span><span class="s">&#39;My New Background&#39;</span><span class="p">,</span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="s">&#39;My New BackPar&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-31" name="sd-tab-set-17" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-31">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;My New Backpar&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;My New Background&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">value_1</span><span class="o">=</span><span class="s1">&#39;My New BackPar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With this code snippet we’ve made a new background, with the value taken from the (fittable) parameter called ‘My New Backpar’:</p>
<a class="reference internal image-reference" href="../_images/constBackgroundAdd.png"><img alt="basic background" src="../_images/constBackgroundAdd.png" style="width: 800px;" /></a>
<p>This is then available to be used by any of our contrasts (see later).</p>
<ul class="simple">
<li><p><strong>Data</strong> - This option is used when a measured data background is available. Suppose our measured data is in a datafile loaded into the data block (see later), and called ‘My Background Data’. To define a data background, we simply specify this datafile in our background specification:</p></li>
</ul>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-32" name="sd-tab-set-18" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-32">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addBackground</span><span class="p">(</span><span class="s">&#39;Data Background 1&#39;</span><span class="p">,</span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="s">&#39;My Background Data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-33" name="sd-tab-set-18" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-33">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data Background 1&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">value_1</span><span class="o">=</span><span class="s1">&#39;My Background Data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/dataBackground.png"><img alt="data background" src="../_images/dataBackground.png" style="width: 800px;" /></a>
<p>This is then used in the reflectivity calculation for any contrast in which it is specified.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No ‘Background Parameters’ are associated with data backgrounds. Also, take care to make sure that the background and data with which it is intended to be used <em>have the same q values</em>, otherwise an interpolation will be carried out which will be slower.</p>
</div>
</section>
<section id="resolutions">
<h3><strong>Resolutions</strong><a class="headerlink" href="#resolutions" title="Permalink to this heading">#</a></h3>
<p>As is the case for the backgrounds, the resolutions block is also splot into two parts: a parameters block which defines the fittable parameters, and then the main Resolutions block which groups these as required into actual resolutions.
The three types are:</p>
<ul class="simple">
<li><p><strong>Constant</strong>: The default type. A resolutionParameter defines the width of a sliding Gaussian window convolution applied to the data.</p></li>
<li><p><strong>Function</strong>: Convolution of the data with an arbitrary, user defined function (not yet implemented).</p></li>
<li><p><strong>Data</strong>: Convolution with a sliding Gaussian defined by a fourth column of a datafile.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only ‘Constant’ and ‘Data’ are implemented in phase 1. Convolution with an arbitrary function will be introduced in phase 2.</p>
</div>
<p>To define a resolution parameter, we use the addResolutionParam method:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-34" name="sd-tab-set-19" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-34">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addResolutionParam</span><span class="p">(</span><span class="s">&#39;My Resolution Param&#39;</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.08</span><span class="p">,</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-35" name="sd-tab-set-19" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-35">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">resolution_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;My Resolution Param&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/resolClass.png"><img alt="resolution class" src="../_images/resolClass.png" style="width: 800px;" /></a>
<p>Then, we make the actual resolution referring to whichever one of the resolution parameters:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-36" name="sd-tab-set-20" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-36">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addResolution</span><span class="p">(</span><span class="s">&#39;My new resolution&#39;</span><span class="p">,</span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="s">&#39;My Resolution Param&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addResolution</span><span class="p">(</span><span class="s">&#39;My Data Resolution&#39;</span><span class="p">,</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-37" name="sd-tab-set-20" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-37">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">resolutions</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">=</span><span class="s">&#39;My new resolution&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">type</span><span class="p">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">value_1</span><span class="p">=</span><span class="s">&#39;My Resolution Param&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="p">.</span><span class="n">resolutions</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">=</span><span class="s">&#39;My Data Resolution&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">type</span><span class="p">=</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/resolClassModified.png"><img alt="resolution class with parameters added" src="../_images/resolClassModified.png" style="width: 800px;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are no parameters with Data resolution. Instead this tells RAT to expect a fourth column in the datafile. If no fourth column exists in the data to which this is applied, RAT will throw an error at runtime.</p>
</div>
</section>
<section id="data">
<h3><strong>Data</strong><a class="headerlink" href="#data" title="Permalink to this heading">#</a></h3>
<p>The data block contains the data which defines at which points in q the reflectivity is calculated at each contrast. By default, it initialises with a single ‘Simulation’ entry:</p>
<a class="reference internal image-reference" href="../_images/defaultData.png"><img alt="default Data class" src="../_images/defaultData.png" style="width: 800px;" /></a>
<p>For each entry in the table there are four fields:</p>
<ul class="simple">
<li><p><strong>Name</strong>: The name you choose to give the datafile (for reference in the contrasts block)</p></li>
<li><p><strong>Data</strong>: An array containing the data itself (empty for Simulation).</p></li>
<li><p><strong>Data Range</strong>: The min / max range of the data you wish to include in the fit. As is the case for RasCAL, you do not have to include all the data in the calculation of chi-squared. This range cannot lie outside the range of any data added to the second column.</p></li>
<li><p><strong>Simulation Range</strong>: The total range of the simulation to be calculated. This can lie outside the range of the data to allow for extrapolation, but must be &gt;= the overall data range.</p></li>
</ul>
<p>To add data, we first load it into Matlab, then create a new data entry containing it:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-38" name="sd-tab-set-21" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-38">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">myData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dlmread</span><span class="p">(</span><span class="s">&#39;c_PLP0016596.dat&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">addData</span><span class="p">(</span><span class="s">&#39;My new datafile&#39;</span><span class="p">,</span><span class="n">myData</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-39" name="sd-tab-set-21" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-39">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">myData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;c_PLP0016596.dat&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">problem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;My new datafile&#39;</span><span class="p">,</span> <span class="n">myData</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>and out new dataset appears in the table:</p>
<a class="reference internal image-reference" href="../_images/dataAdded.png"><img alt="data added to class" src="../_images/dataAdded.png" style="width: 800px;" /></a>
<p>Note that we did not specify data or simulation ranges, and so these default to the min / max values of the data added. To change these (or anything else about the data entry)
use the <em>‘setData’</em> method. Also note that this data has a fourth column, and so can be used as a data resolution if you wish.</p>
</section>
<section id="putting-it-all-together-defining-contrasts">
<h3><strong>Putting it all together – defining contrasts</strong><a class="headerlink" href="#putting-it-all-together-defining-contrasts" title="Permalink to this heading">#</a></h3>
<p>As is the case for RasCAL, once we have defined the various aspects of our project i.e. backgrounds, data and so on, we group these together into contrasts to make out fitting project. We can add a contrast using just it’s name, and edit it later, or we can specify which parts of our project we want to add to the contrast using name value pairs:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-40" name="sd-tab-set-22" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-40">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;D-tail/H-Head/D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Background D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;BulkOut&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;BulkIn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD air&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;D-tail / H-head / D2O&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-41" name="sd-tab-set-22" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-41">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;D-tail/H-Head/D2O&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;Background D2O&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;Resolution 1&#39;</span><span class="p">,</span>
                         <span class="n">scalefactor</span><span class="o">=</span><span class="s1">&#39;Scalefactor 1&#39;</span><span class="p">,</span> <span class="n">bulk_out</span><span class="o">=</span><span class="s1">&#39;SLD D2O&#39;</span><span class="p">,</span> <span class="n">bulk_in</span><span class="o">=</span><span class="s1">&#39;SLD air&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;D-tail / H-head / D2O&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The values which we add must refer to names within the other blocks of the project. So, if you try to add a <em>scalefactor</em> called ‘scalefactor1’ when this name doesn’t exist in the <em>scalefactors</em> block, then an error will result.</p>
<p>Once we have added the contrasts, then we need to set the model, either by adding layers for a <em>standard layers</em> project, or a custom model file (we will discuss these in chapter 3). To add either layers or a custom file, we use the <strong>setModel</strong> method. In the case of layers, we give a list of layer names, in order from bulk in to bulk out. So for a monolayer for example, we would specify tails and then heads in a cell array:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-42" name="sd-tab-set-23" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-42">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Deuterated tails&#39;</span><span class="p">,</span><span class="s">&#39;Hydrogenated heads&#39;</span><span class="p">});</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-43" name="sd-tab-set-23" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-43">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Deuterated tails&#39;</span><span class="p">,</span><span class="s1">&#39;Hydrogenated heads&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The data can be either a datafile or the simulation object in the data block. Once we have defined our contrasts they appear in the <em>contrasts</em> block at the end of the project when it is displayed.</p>
</section>
</section>
</section>
<section id="the-monolayer-example-in-full">
<h1>The Monolayer Example In Full<a class="headerlink" href="#the-monolayer-example-in-full" title="Permalink to this heading">#</a></h1>
<p>In the previous sections, we showed an example of a pre-loaded problem definition class, which we used to analyse data from two contrasts of a lipid monolayer. Now, rather than loading in a pre-defined version of this problem we can use our class methods to build this from scratch, and do the same analysis as we did there, but this time from a script.</p>
<p>To start, we first make an instance of the project class:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-44" name="sd-tab-set-24" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-44">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">projectClass</span><span class="p">(</span><span class="s">&#39;DSPC monolayers&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-45" name="sd-tab-set-24" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-45">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">RAT</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="s1">&#39;DSPC monolayers&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Then we need to define the parameters we need. We’ll do this by making a parameters block, and adding these to project class with the <strong>addParamGroup</strong> method:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-46" name="sd-tab-set-25" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-46">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Define the parameters:</span>
<span class="n">Parameters</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c">%       Name                min     val     max      fit?</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Tails Thickness&#39;</span><span class="p">,</span><span class="w">         </span><span class="mi">10</span><span class="p">,</span><span class="w">     </span><span class="mi">20</span><span class="p">,</span><span class="w">      </span><span class="mi">30</span><span class="p">,</span><span class="w">     </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Heads Thickness&#39;</span><span class="p">,</span><span class="w">          </span><span class="mi">3</span><span class="p">,</span><span class="w">     </span><span class="mi">11</span><span class="p">,</span><span class="w">      </span><span class="mi">16</span><span class="p">,</span><span class="w">     </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Tails Roughness&#39;</span><span class="p">,</span><span class="w">          </span><span class="mi">2</span><span class="p">,</span><span class="w">     </span><span class="mi">5</span><span class="p">,</span><span class="w">       </span><span class="mi">9</span><span class="p">,</span><span class="w">      </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Heads Roughness&#39;</span><span class="p">,</span><span class="w">          </span><span class="mi">2</span><span class="p">,</span><span class="w">     </span><span class="mi">5</span><span class="p">,</span><span class="w">       </span><span class="mi">9</span><span class="p">,</span><span class="w">      </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Deuterated Tails SLD&#39;</span><span class="p">,</span><span class="w">    </span><span class="mf">4e-6</span><span class="p">,</span><span class="w">   </span><span class="mf">6e-6</span><span class="p">,</span><span class="w">    </span><span class="mf">2e-5</span><span class="p">,</span><span class="w">   </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Hydrogenated Tails SLD&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6e-6</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4e-6</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">      </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Deuterated Heads SLD&#39;</span><span class="p">,</span><span class="w">    </span><span class="mf">1e-6</span><span class="p">,</span><span class="w">   </span><span class="mf">3e-6</span><span class="p">,</span><span class="w">    </span><span class="mf">8e-6</span><span class="p">,</span><span class="w">   </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Hydrogenated Heads SLD&#39;</span><span class="p">,</span><span class="w">  </span><span class="mf">0.1e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">1.4e-6</span><span class="p">,</span><span class="w">  </span><span class="mf">3e-6</span><span class="p">,</span><span class="w">   </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">{</span><span class="s">&#39;Heads Hydration&#39;</span><span class="p">,</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span><span class="w">      </span><span class="mf">0.3</span><span class="p">,</span><span class="w">     </span><span class="mf">0.5</span><span class="p">,</span><span class="w">    </span><span class="nb">true</span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span>

<span class="n">problem</span><span class="p">.</span><span class="n">addParameterGroup</span><span class="p">(</span><span class="n">Parameters</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Next we need to group the parameters into our layers. We need four layers in all, representing deuterated and hydrogenated versions of the heads and tails:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-47" name="sd-tab-set-26" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-47">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">H_Heads</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Hydrogenated Heads&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Heads Thickness&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Hydrogenated Heads SLD&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Heads Roughness&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Heads Hydration&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;bulk out&#39;</span><span class="w"> </span><span class="p">};</span>

<span class="n">D_Heads</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Deuterated Heads&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Heads Thickness&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Deuterated Heads SLD&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Heads Roughness&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Heads Hydration&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;bulk out&#39;</span><span class="w"> </span><span class="p">};</span>

<span class="n">D_Tails</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Deuterated Tails&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Tails Thickness&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Deuterated Tails SLD&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Tails Roughness&#39;</span><span class="p">};</span>

<span class="n">H_Tails</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Hydrogenated Tails&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Tails Thickness&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Hydrogenated Tails SLD&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">        </span><span class="s">&#39;Tails Roughness&#39;</span><span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The headgroups are hydrated and so share a hydration parameter, whereas the tails are not.</p>
</div>
<p>We add our layers to the project using the <strong>addLayerGroup</strong> method:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-48" name="sd-tab-set-27" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-48">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addLayerGroup</span><span class="p">({</span><span class="n">H_Heads</span><span class="p">;</span><span class="w"> </span><span class="n">D_Heads</span><span class="p">;</span><span class="w"> </span><span class="n">H_Tails</span><span class="p">;</span><span class="w"> </span><span class="n">D_Tails</span><span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<p>We are using two different sub-phases: D2O and ACMW. We need a different constant background for each, so we need two ‘backPar’ parameters. There is already one background parameter in the project as a default, so we rename this and add a second one:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-49" name="sd-tab-set-28" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-49">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setBackgroundParamName</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Backs value ACMW&#39;</span><span class="p">);</span><span class="w"> </span><span class="c">% Use existing backsPar</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBackgroundParamValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">5.5e-6</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addBackgroundParam</span><span class="p">(</span><span class="s">&#39;Backs Value D2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-8</span><span class="p">,</span><span class="w"> </span><span class="mf">2.8e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-50" name="sd-tab-set-28" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-50">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Backs value ACMW&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.5e-6</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Backs Value D2O&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.8e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Use these parameters to define two constant backgrounds, again using the existing default for one of them:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-51" name="sd-tab-set-29" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-51">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addBackground</span><span class="p">(</span><span class="s">&#39;Background D2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;constant&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Backs Value D2O&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBackground</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Background ACMW&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;value1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Backs Value ACMW&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-52" name="sd-tab-set-29" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-52">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background D2O&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">value_1</span><span class="o">=</span><span class="s1">&#39;Backs Value D2O&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">backgrounds</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Background ACMW&#39;</span><span class="p">,</span> <span class="s1">&#39;value_1&#39;</span><span class="o">=</span><span class="s1">&#39;Backs Value ACMW&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We need two sub-phases for our project. D2O is already in the project as a default, so we only need to add the bulk out for ACMW</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-53" name="sd-tab-set-30" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-53">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addBulkOut</span><span class="p">(</span><span class="s">&#39;SLD ACMW&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1e-6</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-6</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-54" name="sd-tab-set-30" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-54">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SLD ACMW&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.6e-6</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mf">0.56e-6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=-</span><span class="mf">0.3e-6</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we need to add the data. We read in the two files into MATLAB, and put the data into the data block with appropriate names:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-55" name="sd-tab-set-31" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-55">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">d13ACM</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dlmread</span><span class="p">(</span><span class="s">&#39;d13acmw20.dat&#39;</span><span class="p">);</span>
<span class="n">d70d2O</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dlmread</span><span class="p">(</span><span class="s">&#39;d70d2o20.dat&#39;</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addData</span><span class="p">(</span><span class="s">&#39;H-tail / D-head / ACMW&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">d13ACM</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addData</span><span class="p">(</span><span class="s">&#39;D-tail / H-head / D2O&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">d70d2O</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-56" name="sd-tab-set-31" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-56">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">d13ACM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;d13acmw20.dat&#39;</span><span class="p">)</span>
<span class="n">d70d2O</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;d70d2o20.dat&#39;</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;H-tail / D-head / ACMW&#39;</span><span class="p">,</span> <span class="n">d13ACM</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;D-tail / H-head / D2O&#39;</span><span class="p">,</span> <span class="n">d70d2O</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We have everything we need to now build our contrasts. We have two contrasts in all, and we build them using name / value pairs for all the different parts of the contrasts (i.e. selecting which background and bulk phases etc we need using the names we have given them.)</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-57" name="sd-tab-set-32" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-57">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;D-tail/H-Head/D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Background D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;BulkOut&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD D2O&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;BulkIn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD air&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;D-tail / H-head / D2O&#39;</span><span class="p">);</span>

<span class="n">problem</span><span class="p">.</span><span class="n">addContrast</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;H-tail/D-Head/ACMW&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;background&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Background ACMW&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;resolution&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Resolution 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;scalefactor&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Scalefactor 1&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;BulkOut&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD ACMW&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;BulkIn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;SLD air&#39;</span><span class="p">,</span><span class="k">...</span>
<span class="w">                    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;H-tail / D-head / ACMW&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-58" name="sd-tab-set-32" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-58">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;D-tail/H-Head/D2O&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;Background D2O&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;Resolution 1&#39;</span><span class="p">,</span>
                         <span class="n">scalefactor</span><span class="o">=</span><span class="s1">&#39;Scalefactor 1&#39;</span><span class="p">,</span> <span class="n">bulk_out</span><span class="o">=</span><span class="s1">&#39;SLD D2O&#39;</span><span class="p">,</span> <span class="n">bulk_in</span><span class="o">=</span><span class="s1">&#39;SLD air&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;D-tail / H-head / D2O&#39;</span><span class="p">)</span>

<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;H-tail/D-Head/ACMW&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;Background ACMW&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;Resolution 1&#39;</span><span class="p">,</span>
                         <span class="n">scalefactor</span><span class="o">=</span><span class="s1">&#39;Scalefactor 1&#39;</span><span class="p">,</span> <span class="n">bulk_out</span><span class="o">=</span><span class="s1">&#39;SLD ACMW&#39;</span><span class="p">,</span> <span class="n">bulk_in</span><span class="o">=</span><span class="s1">&#39;SLD air&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;D-tail / H-head / D2O&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To define the models for each contrast, we add the relevant layers as appropriate:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-59" name="sd-tab-set-33" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-59">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Deuterated tails&#39;</span><span class="p">,</span><span class="s">&#39;Hydrogenated heads&#39;</span><span class="p">});</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setContrastModel</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;hydrogenated tails&#39;</span><span class="p">,</span><span class="s">&#39;deuterated heads&#39;</span><span class="p">});</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-60" name="sd-tab-set-33" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-60">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Deuterated tails&#39;</span><span class="p">,</span> <span class="s1">&#39;Hydrogenated heads&#39;</span><span class="p">])</span>
<span class="n">problem</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hydrogenated tails&#39;</span><span class="p">,</span> <span class="s1">&#39;deuterated heads&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We need to make sure that we are fitting the relevant backgrounds, scalefactors and bulk phase values:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-61" name="sd-tab-set-34" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-61">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setBackgroundParam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBackgroundParam</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setScalefactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBulkOut</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;fit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-62" name="sd-tab-set-34" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-62">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">background_parameters</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">scalefactor</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">bulk_out</span><span class="o">.</span><span class="n">set_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now have a look at our project, to make sure it all looks reasonable</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-63" name="sd-tab-set-35" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-63">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-64" name="sd-tab-set-35" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-64">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<img alt="Display the details of problem (first half)" src="../_images/dispProblem1.png" />
<img alt="Display the details of problem (second half)" src="../_images/dispProblem2.png" />
<p>Now we’ll calculate this to check the agreement with the data. We need an instance of the controls class, with the procedure attribute set to <em>calculate</em> (the default):</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-65" name="sd-tab-set-36" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-65">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">controls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">controlsClass</span><span class="p">();</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">controls</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/controlsClass.png"><img alt="Displays Controls" src="../_images/controlsClass.png" style="width: 400px;" /></a>
<p>We then send all of this to RAT, and plot the output:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-66" name="sd-tab-set-37" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-66">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">problem</span><span class="p">,</span><span class="n">results</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">RAT</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="n">controls</span><span class="p">);</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-67" name="sd-tab-set-37" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-67">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<img alt="Displays the RAT processing and chi squared" src="../_images/ratRun1.png" />
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-68" name="sd-tab-set-38" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-68">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="nb">clf</span><span class="p">;</span>
<span class="n">plotRefSLD</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-69" name="sd-tab-set-38" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-69">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">RAT.utils.plotting</span> <span class="k">as</span> <span class="nn">rp</span>
<span class="n">rp</span><span class="o">.</span><span class="n">plot_ref_sld</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<img alt="Displays reflectivity and SLD plot" src="../_images/plot1.png" />
<p>To do a fit, we change the <em>procedure</em> attribute of the controls class to <strong>simplex</strong> . We will also change the ‘parallel’ option to ‘contrasts’, so that each contrast gets it’s own calculation thread, and modify the output to only display the final result (rather than each iteration):</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-70" name="sd-tab-set-39" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-70">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="n">controls</span><span class="p">.</span><span class="n">procedure</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;simplex&#39;</span><span class="p">;</span>
<span class="n">controls</span><span class="p">.</span><span class="n">parallel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;contrasts&#39;</span><span class="p">;</span>
<span class="n">controls</span><span class="p">.</span><span class="n">display</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;final&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-71" name="sd-tab-set-39" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-71">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">controls</span> <span class="o">=</span> <span class="n">RAT</span><span class="o">.</span><span class="n">set_controls</span><span class="p">(</span><span class="s1">&#39;simplex&#39;</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="s1">&#39;contrasts&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">&#39;final&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/simplexControls1.png"><img alt="simplex controls class" src="../_images/simplexControls1.png" style="width: 500px;" /></a>
<p>..and then run our fit and plot the results…</p>
<a class="reference internal image-reference" href="../_images/simplexRun.png"><img alt="running simplex" src="../_images/simplexRun.png" style="width: 800px;" /></a>
<a class="reference internal image-reference" href="../_images/simplexFit.png"><img alt="simplex results" src="../_images/simplexFit.png" style="width: 600px;" /></a>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-72" name="sd-tab-set-40" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-72">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-73" name="sd-tab-set-40" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-73">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="../_images/dispResults1.png"><img alt="Displays results" src="../_images/dispResults1.png" style="width: 300px;" /></a>
<p>We can now plot the results of our fit:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-74" name="sd-tab-set-41" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Matlab" for="sd-tab-item-74">
MATLAB</label><div class="sd-tab-content docutils">
<div class="highlight-Matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span><span class="p">;</span><span class="w"> </span><span class="n">clf</span>
<span class="s">plotRefSLD(out,results)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-75" name="sd-tab-set-41" type="radio">
<label class="sd-tab-label" data-sync-group="code" data-sync-id="Python" for="sd-tab-item-75">
PYTHON</label><div class="sd-tab-content docutils">
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">RAT.utils.plotting</span> <span class="k">as</span> <span class="nn">rp</span>
<span class="n">rp</span><span class="o">.</span><span class="n">plot_ref_sld</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<img alt="Displays reflectivity and SLD plot" src="../_images/plot2.png" />
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">The Problem Definition Input Class</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-components-of-projectclass">The Components of ProjectClass</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#project-defining-methods"><strong>Project Defining Methods</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-parameters-block"><strong>The ‘Parameters’ Block</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-layers-block-standard-layers-models-only"><strong>The Layers Block (Standard Layers models only)</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bulk-phases"><strong>Bulk Phases</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scalefactors"><strong>Scalefactors</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#backgrounds"><strong>Backgrounds</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resolutions"><strong>Resolutions</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data"><strong>Data</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together-defining-contrasts"><strong>Putting it all together – defining contrasts</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-monolayer-example-in-full">The Monolayer Example In Full</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/tutorial/chapter2.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022-2024, ISIS Neutron and Muon Source.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>